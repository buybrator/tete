@import "tailwindcss";
@import "tw-animate-css";

@custom-variant dark (&:is(.dark *));

:root {
  --background: oklch(95.38% 0.0357 72.89);
  --secondary-background: oklch(100% 0 0);
  --foreground: oklch(0% 0 0);
  --main-foreground: oklch(0% 0 0);
  --main: oklch(72.27% 0.1894 50.19);
  --border: oklch(0% 0 0);
  --ring: oklch(0% 0 0);
  --overlay: oklch(0% 0 0 / 0.8);
  --shadow: 4px 4px 0px 0px var(--border);
  --chart-1: #FF7A05;
  --chart-2: #0099FF;
  --chart-3: #FFBF00;
  --chart-4: #00D696;
  --chart-5: #7A83FF;
  --chart-active-dot: #000;
  --buy-button: oklch(66.9% 0.18368 248.8066);
  --sell-button: oklch(67.28% 0.2147 24.22);
}

.dark {
  --background: oklch(26.86% 0.0327 60.06);
  --secondary-background: oklch(23.93% 0 0);
  --foreground: oklch(92.49% 0 0);
  --main-foreground: oklch(0% 0 0);
  --main: oklch(67.56% 0.1796 49.61);
  --border: oklch(0% 0 0);
  --ring: oklch(100% 0 0);
  --shadow: 4px 4px 0px 0px var(--border);
  --chart-1: #EB6D00;
  --chart-2: #008AE5;
  --chart-3: #E5AC00;
  --chart-4: #00BD84;
  --chart-5: #7A83FF;
  --chart-active-dot: #fff;
  --buy-button: oklch(66.9% 0.18368 248.8066);
  --sell-button: oklch(67.28% 0.2147 24.22);
}

@theme inline {
  --color-main: var(--main);
  --color-background: var(--background);
  --color-secondary-background: var(--secondary-background);
  --color-foreground: var(--foreground);
  --color-main-foreground: var(--main-foreground);
  --color-border: var(--border);
  --color-overlay: var(--overlay);
  --color-ring: var(--ring);
  --color-chart-1: var(--chart-1);
  --color-chart-2: var(--chart-2);
  --color-chart-3: var(--chart-3);
  --color-chart-4: var(--chart-4);
  --color-chart-5: var(--chart-5);

  --spacing-boxShadowX: 4px;
  --spacing-boxShadowY: 4px;
  --spacing-reverseBoxShadowX: -4px;
  --spacing-reverseBoxShadowY: -4px;
  --radius-base: 5px;
  --shadow-shadow: var(--shadow);
  --font-weight-base: 500;
  --font-weight-heading: 700;
}
  
@layer base {
  html {
    overflow-x: hidden;
  }
  
  body {
    @apply text-foreground font-base bg-background;
    overflow-x: hidden;
    position: relative;
    /* 모바일에서 바운스 스크롤 방지 */
    overscroll-behavior: none;
    /* iOS Safari에서 줌 방지 */
    touch-action: manipulation;
  }
  
  /* 모바일에서 전체 스크롤 방지 - 사이드바와 관계없이 항상 유지 */
  @media (max-width: 1023px) {
    html, body {
      height: 100%;
      overflow: hidden;
      position: fixed;
      width: 100%;
    }
    
    /* 모바일 고정 요소들의 안정성 보장 */
    .mobile-navbar,
    .mobile-trade-drawer,
    .mobile-putter {
      position: fixed !important;
      /* iOS Safari에서 고정 위치 문제 해결 */
      transform: translateZ(0);
      -webkit-transform: translateZ(0);
      will-change: transform;
    }
  }

  h1, h2, h3, h4, h5, h6{
    @apply font-heading;
  }


  /* 네오브루탈리즘 스타일 강화 */
  button, .btn, [type="button"], [type="submit"] {
    border-width: 2px;
    border-color: var(--border);
    box-shadow: var(--shadow);
    background: var(--main);
    color: var(--main-foreground);
    border-radius: var(--radius-base);
    font-weight: var(--font-weight-heading);
    transition: filter 0.1s;
  }
  button:active, .btn:active {
    filter: brightness(0.95);
  }

  input, textarea, select {
    border-width: 2px;
    border-color: var(--border);
    box-shadow: var(--shadow);
    background: var(--secondary-background);
    color: var(--foreground);
    border-radius: var(--radius-base);
    font-weight: var(--font-weight-base);
  }

  .badge {
    border-width: 2px;
    border-color: var(--border);
    box-shadow: var(--shadow);
    background: var(--main);
    color: var(--main-foreground);
    border-radius: var(--radius-base);
    font-weight: var(--font-weight-heading);
  }
}

/* 반응형 레이아웃 스타일 */
@layer components {
  /* Desktop Layout (≥1024px) */
  .desktop-layout {
    @apply hidden lg:flex lg:flex-col lg:h-screen lg:overflow-hidden lg:p-4 lg:gap-4 lg:bg-background;
  }
  
  .desktop-navbar {
    @apply w-full h-16 px-6 flex items-center justify-between bg-secondary-background border-2 border-border shadow-[var(--shadow)];
    border-radius: 15px;
    flex-shrink: 0; /* Navbar 크기 고정 */
  }
  
  .desktop-main {
    @apply flex flex-row gap-4 flex-1 min-h-0; /* Navbar 아래 남은 공간 모두 차지 */
    /* overflow: hidden; */ /* 그림자가 보이도록 제거 */
  }
  
  .desktop-chat-area {
    @apply flex-1 flex flex-col bg-secondary-background border-2 border-border shadow-[var(--shadow)];
    border-radius: 15px;
    min-height: 0; /* flexbox 자식 요소가 제대로 작동하도록 */
    height: 100%; /* 부모 높이를 모두 차지 */
  }
  
  .desktop-trade-panel {
    @apply w-80 flex flex-col bg-secondary-background border-2 border-border shadow-[var(--shadow)];
    border-radius: 15px;
    min-height: 0; /* flexbox 오버플로우 방지 */
    overflow: hidden; /* 내부 스크롤 관리 */
  }

  /* Mobile Layout (<1024px) */
  .mobile-layout {
    @apply flex lg:hidden flex-col overflow-hidden bg-background;
    height: 100vh;
    height: 100dvh; /* Dynamic viewport height 지원 */
    padding: 12px;
    padding-top: 12px; /* navbar 제거로 기본 여백만 */
    padding-bottom: 84px; /* mobile-putter 높이(60px) + 여백(12px * 2) */
    gap: 12px;
  }
  
  .mobile-navbar {
    @apply w-full h-14 flex items-center justify-between bg-secondary-background border-2 border-border shadow-[var(--shadow)] fixed z-50;
    border-radius: 15px;
    padding: 0 12px;
    top: 12px;
    left: 12px;
    right: 12px;
    /* 브라우저 호환성을 위한 fallback */
    width: calc(100vw - 24px);
    max-width: calc(100vw - 24px);
    box-sizing: border-box;
  }
  
  .mobile-main {
    @apply flex flex-col flex-1 min-h-0;
    gap: 12px;
    /* trade drawer와 겹치지 않도록 하단 여백 추가 */
    margin-bottom: 187px; /* trade drawer 175px + 12px 여백 */
  }
  
  .mobile-chat-area {
    @apply flex-1 flex flex-col bg-secondary-background border-2 border-border;
    border-radius: 15px;
    box-shadow: var(--shadow);
    min-height: 0; /* flexbox 자식 요소가 제대로 작동하도록 */
    height: 100%; /* 부모 높이를 모두 차지 */
  }
  
  .mobile-trade-drawer {
    @apply bg-secondary-background border-2 border-border shadow-[var(--shadow)] fixed z-20;
    height: 175px;
    border-radius: 15px;
    left: 12px;
    right: 12px;
    bottom: 84px; /* mobile-putter 높이(60px) + 여백(12px * 2) */
    overflow: hidden;
    /* 브라우저 호환성을 위한 fallback */
    width: calc(100vw - 24px);
    max-width: calc(100vw - 24px);
    box-sizing: border-box;
  }
  
  .mobile-putter {
    @apply h-[60px] flex justify-around items-center bg-secondary-background border-2 border-border shadow-[var(--shadow)] fixed z-30;
    border-radius: 15px;
    left: 12px;
    right: 12px;
    bottom: 12px;
    /* 브라우저 호환성을 위한 fallback */
    width: calc(100vw - 24px);
    max-width: calc(100vw - 24px);
    box-sizing: border-box;
  }

  /* Chat Components */
  .chat-tabs {
    @apply px-3 pt-3 pb-0;
  }
  
  .chat-messages {
    @apply p-3 bg-white;
    /* flex-1을 명시적으로 설정 */
    flex: 1 1 0%;
    /* 스크롤 강제 활성화 */
    overflow-y: scroll !important; /* auto에서 scroll로 변경하고 !important 추가 */
    overflow-x: hidden !important;
    /* 모바일 터치 스크롤 개선 */
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
    scroll-behavior: smooth;
    /* 스크롤을 위한 기본 설정 */
    min-height: 0;
    overflow-anchor: none;
    /* 높이 제한 제거 - flex가 알아서 계산하도록 */
  }
  
  .chat-messages > * {
    margin-bottom: 0.75rem; /* 메시지 간격 */
  }
  
  .chat-messages > *:last-child {
    margin-bottom: 0; /* 마지막 메시지는 하단 마진 제거 */
  }
  
  .chat-input-area {
    @apply p-3 border-t;
    border-top: 2px solid var(--border);
    /* 모바일에서 입력 영역 고정 */
    flex-shrink: 0;
  }
  
  .chat-bubble {
    @apply max-w-fit px-4 py-3 rounded-lg border-2 border-border shadow-[var(--shadow)];
  }
  
  .chat-bubble-buy {
    @apply bg-main text-main-foreground;
  }
  
  .chat-bubble-sell {
    @apply bg-red-500 text-white;
  }

  /* Trade Panel Components */
  .trade-toggle-buttons {
    @apply flex gap-2 p-4;
  }
  
  .trade-amount-input {
    @apply p-4;
  }
  
  .trade-presets {
    @apply flex gap-2 p-4 flex-wrap;
  }
  
  .trade-advanced {
    @apply flex gap-2 p-4;
  }

  /* Navbar Components */
  .navbar-logo {
    @apply font-bold text-xl tracking-wider select-none;
  }
  
  .navbar-center {
    @apply flex-1 mx-4 max-w-md;
  }
  
  .navbar-right {
    @apply flex items-center gap-2;
  }

  /* 유틸리티 클래스 */
  .neobrutalism-card {
    @apply border-2 border-border bg-background rounded shadow-[var(--shadow)];
  }
  
  .neobrutalism-button {
    @apply border-2 border-border bg-main text-main-foreground rounded font-bold shadow-[var(--shadow)] transition-all hover:translate-x-0.5 hover:translate-y-0.5 hover:shadow-none active:translate-x-1 active:translate-y-1 active:shadow-none;
  }
  
  .neobrutalism-input {
    @apply border-2 border-border bg-secondary-background text-foreground;
    box-shadow: var(--shadow);
  }
}

/* 그림자 제거 스타일 */
.mobile-trade-drawer input,
.mobile-trade-drawer .w-full.bg-gray-50 {
  box-shadow: none !important;
  outline: none !important;
}

.mobile-trade-drawer input:focus,
.mobile-trade-drawer input:focus-visible {
  box-shadow: none !important;
  outline: none !important;
  ring: none !important;
}

/* 검색 사이드바 전용 스타일 */
.search-sidebar {
  /* 완전히 독립적인 고정 위치 */
  position: fixed !important;
  top: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  z-index: 9999 !important;
  /* 사이드바 자체는 overflow hidden */
  overflow: hidden;
  /* 기존 레이아웃에 영향을 주지 않도록 */
  margin: 0 !important;
  padding: 0 !important;
  /* 애니메이션 추가 */
  transform: translateX(0);
  transition: transform 0.3s ease-in-out;
}

.search-sidebar-content {
  /* 스크롤 가능한 영역만 스크롤 활성화 */
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
  /* 정확한 높이 계산 */
  height: calc(100vh - 140px); /* 헤더와 푸터 제외 */
}

/* 사이드바 오버레이 */
.search-sidebar-overlay {
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  z-index: 9998 !important;
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(2px);
}